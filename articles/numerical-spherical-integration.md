---
title: "çƒé¢ä¸Šç©åˆ†ã®æ•°å€¤è¨ˆç®—æ³•"
emoji: "ğŸ—‚"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["c","fft","nfft", "æ•°å­¦"]
published: false
---

# çƒé¢ä¸Šç©åˆ†

çƒé¢ä¸Šã®ç©åˆ†

$$
\int_{\mathbb{S}^2} f(\boldsymbol{x}) ~d\boldsymbol{x}
$$

ã‚’æ•°å€¤çš„ã«å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã®è¨˜äº‹ã§ã™ï¼

$M$å€‹ã®ä»£è¡¨ç‚¹ï¼Œ

$$
\{ \boldsymbol{x}_{0}, \dots, \boldsymbol{x}_{M-1}\},
$$

ãŒä¸ãˆã‚‰ã‚Œã‚‹ã¨ï¼Œæ•°å€¤ç©åˆ†ã¯ï¼Œ

$$
\int_{\mathbb{S}^2} f(\boldsymbol{x}) ~d\boldsymbol{x} \simeq \sum_{i=0}^{M-1} w_i f(\boldsymbol{x}_i)
$$

ã¨ãªã‚‹é‡ã¿$w_i$ã‚’æ¢ã™ã¨ã„ã†å•é¡Œã«ãªã‚Šã¾ã™ï¼

ã“ã“ã§ï¼Œ$w_i \,\,(i = 0,\dots,M-1)$ ã¯ï¼Œä»¥ä¸‹ã®æ€§è³ªã‚’æº€ãŸã—ã¾ã™ï¼

1. $w_i > 0$ for $\forall i$
2. $\sum_{i=0}^{M-1} w_i = 4\pi$

1.ã«ã¤ã„ã¦ã¯ï¼Œãƒ™ã‚¯ãƒˆãƒ« $\boldsymbol{w} \equiv (w_i) > 0$ ã¨è¡¨ã™ã“ã¨ã«ã—ã¾ã™ï¼

ã“ã®è¨˜äº‹ã§ã¯ï¼Œ

1. ä»£è¡¨ç‚¹ã‚’è‡ªç”±ã«æ±ºã‚ã‚‰ã‚Œã‚‹å ´åˆ
2. ä»£è¡¨ç‚¹ãŒã‚ã‚‰ã‹ã˜ã‚ä¸ãˆã‚‰ã‚Œã¦ã„ã‚‹å ´åˆ

ã®ï¼’ã¤ã®å ´åˆãã‚Œãã‚Œã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ï¼

ã¾ãŸï¼Œã“ã“ã‹ã‚‰ã¯ï¼Œç°¡å˜ã®ãŸã‚ï¼Œ$\mathbb{S}^2$ã¯å˜ä½çƒé¢ã§ã‚ã‚‹ã¨ã—ã¾ã™ï¼
ã¤ã¾ã‚Šï¼Œçƒé¢ä¸Šã®ç‚¹$\boldsymbol{x}$ã¯ï¼Œ

$$
\boldsymbol{x} = (\cos\theta\sin\varphi, \sin\theta\sin\varphi, \cos\varphi)
$$

ã¨ $(\theta, \varphi)$ã§ã‹ã‘ã‚‹å ´åˆã‚’è€ƒãˆã¾ã™ï¼ä¸€èˆ¬ã®åŠå¾„$r$ã®çƒé¢ä¸Šç©åˆ†ã«å¯¾ã—ã¦ã¯ï¼Œ$\boldsymbol{x} \rightarrow \boldsymbol{x}/r \equiv \boldsymbol{z}$ã¨å¤‰æ•°å¤‰æ›ã™ã‚‹ã¨ï¼ŒåŒã˜å•é¡Œã«å¸°ç€ã—ã¾ã™ï¼


# ä»£è¡¨ç‚¹ã‚’è‡ªç”±ã«æ±ºã‚ã‚‰ã‚Œã‚‹å ´åˆ

## Gauss-Legendreæ±‚ç©æ³•

## ä¾‹

```math
f(x) = \frac{1}{1+x^2}
```

# ä»£è¡¨ç‚¹ãŒã‚ã‚‰ã‹ã˜ã‚ä¸ãˆã‚‰ã‚Œã¦ã„ã‚‹å ´åˆ

ä¾‹ãˆã°ï¼Œå®Ÿé¨“ã‚„è¦³æ¸¬ã‚’ã™ã‚‹å ´åˆï¼Œæ©Ÿæã®è¨­ç½®å ´æ‰€ã®é–¢ä¿‚ã«ã‚ˆã£ã¦ï¼Œå¾—ã‚‰ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®ä½ç½®ãŒæ±ºã¾ã£ã¦ã„ã‚‹å ´åˆã«ã¯ï¼Œã“ã¡ã‚‰ã®æ–¹æ³•ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼

ã“ã®å ´åˆï¼Œä»£è¡¨ç‚¹$\{\boldsymbol{x}_0, \dots, \boldsymbol{x}_{M-1}\}$ã¯ï¼Œ

1. ç­‰é–“éš”ã§ãªã„ã‹ã‚‚ã—ã‚Œãªã„ï¼
2. ä¸€æ§˜ã«åˆ†å¸ƒã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ã‹ã‚‚ã—ã‚Œãªã„ï¼

ã¨ã„ã†ï¼Œãªã‹ãªã‹å³ã—ã„å ´åˆã‚‚å«ã¾ã‚Œã¾ã™ï¼

## å®šå¼åŒ–

å…·ä½“çš„ãªæ•°å€¤è¨ˆç®—ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ï¼‰ã«å…¥ã‚‹å‰ã«ï¼Œæ•°å€¤è¨ˆç®—ã®ç†è«–çš„ãªå´é¢ã‚’ã–ã£ãã‚Šã¨èª¬æ˜ã—ã¾ã™ï¼
ã“ã®å ´åˆã§ã‚‚ï¼Œå•é¡Œã¯ï¼Œ

$$
\int_{\mathbb{S}^2} f(\boldsymbol{x}) ~d\boldsymbol{x} \simeq \sum_{i=0}^{M-1} w_i f(\boldsymbol{x}_i)
$$

ã‚’æº€ãŸã™ï¼ˆæœ€ã‚‚è‰¯ã„è¿‘ä¼¼ã¨ãªã‚‹ã‚ˆã†ãªï¼‰$w_i$ã‚’æ±‚ã‚ã‚ˆï¼Œã¨ã„ã†ã“ã¨ã«å¤‰ã‚ã‚Šã‚ã‚Šã¾ã›ã‚“ï¼

ã—ãŒã—ãªãŒã‚‰ï¼Œä»£è¡¨ç‚¹ $\boldsymbol{x}_i, \,\, (i=0,\dots,M-1)$ ã¯ã™ã§ã«ä¸ãˆã‚Œã‚‰ã¦ã„ã¦ï¼Œã“ã¡ã‚‰ã§ï¼Œé©å½“ãªã‚‚ã®ã‚’é¸ã¶ã“ã¨ãŒã§ãã¾ã›ã‚“ï¼

ã—ãŸãŒã£ã¦ï¼Œä»£è¡¨ç‚¹ã®å–ã‚Šæ–¹ã¯æ±ºã¾ã£ã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¦ï¼Œé‡ã¿ $w_i$ ã‚’æ±ºã‚ã‚‹ã¨ã„ã†å•é¡Œã«ãªã‚Šã¾ã™ï¼

### çƒé¢èª¿å’Œé–¢æ•°ã«ã‚ˆã‚‹å±•é–‹

ã“ã®å ´åˆï¼Œä¸Šè¨˜ã®ã‚ˆã†ã«å‹æ‰‹ã«ä»£è¡¨ç‚¹ã‚’æ±ºã‚ã‚‹ã“ã¨ãŒã§ããªã„ã®ã§é›£ã—ã„ã§ã™ï¼
ãã“ã§ï¼Œé–¢æ•°$f(x)$ã‚’çƒé¢èª¿å’Œé–¢æ•°

$$
Y_k^n(\boldsymbol{x}) = Y_k^n(\theta, \varphi) \equiv \sqrt{\frac{2n+1}{4\pi}} P^n_{|k|}(\cos\theta) e^{ik\varphi}
$$

ã§ã§ãã‚‹é™ã‚Šå±•é–‹ã—ã¾ã™ï¼ã“ã“ã§ï¼Œ$P^n_{|k|}$ã¯Legendreé–¢æ•°ã§ã™ï¼
ã¤ã¾ã‚Šï¼Œ

$$
f(\boldsymbol{x}) \simeq f_N(\boldsymbol{x}) = \sum_{k=0}^{N} \sum_{n=-k}^{n=k} a^n_k Y_k^n(\boldsymbol{x})
$$

ã¨è¿‘ä¼¼ã—ã¾ã™ï¼$N$ãŒå¤§ãã‘ã‚Œã°å¤§ãã„ã»ã©ã‚ˆã„è¿‘ä¼¼ã«ãªã‚Šã¾ã™ï¼ã“ã“ã§ï¼Œå±•é–‹ä¿‚æ•°$a_k^n$ã¯ï¼Œ

$$
a_k^n = \int_{\mathbb{S}^2} f(\boldsymbol{x})\overline{Y_k^n(\boldsymbol{x})} ~d\boldsymbol{x}
$$

ã§ã™ï¼

### é‡ã¿ã®è¨ˆç®—

ã“ã‚Œã‚‰ã‹ã‚‰ï¼Œé‡ã¿$w_i$ã¯ï¼Œ

$$
\boldsymbol{Y}^* \boldsymbol{w} = \sqrt{4\pi} \boldsymbol{e}_0
$$

ã‚’æº€ãŸã™ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ï¼ã“ã“ã§ï¼Œ

$$
\begin{align*}
\boldsymbol{Y} &\equiv (Y_k^n(\boldsymbol{x}_i)_{i=0,\dots, M-1; n=0,\dots N, |k| \leq n} \in \mathbb{C}^{M\times(N+1)^2} \\
\boldsymbol{e}_0 &\equiv (1,0,\dots, 0)^T \in \mathbb{R}^{(N+1)^2} \\
\boldsymbol{w} &\equiv (w_i)_{i=0,\dots,M-1} \in \mathbb{R}^M
\end{align*}
$$

ã§ï¼Œ$\boldsymbol{Y}^*$ã¯ï¼Œ$\boldsymbol{Y}$ã®éšä¼´è¡Œåˆ—ã§ã™ï¼

ã—ãŸãŒã£ã¦ï¼Œä¸Šè¨˜ã®é€£ç«‹æ–¹ç¨‹å¼ã‚’æº€ãŸã™$\boldsymbol{w}$ã‚’æ±‚ã‚ã‚Œã°è‰¯ã„ã§ã™ï¼é€£ç«‹æ–¹ç¨‹å¼ã®è§£ãŒãªã„å ´åˆã‚‚ã‚ã‚Šã†ã‚‹ã®ã§ï¼Œå®Ÿéš›ã«ã¯ï¼Œ

$$
\min_{\boldsymbol{w} \geq 0} \left| \boldsymbol{Y}^* \boldsymbol{w} - \sqrt{4\pi} \boldsymbol{e}_0 \right|
$$

ã‚’æ±‚ã‚ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ï¼

### ï¼ˆæ•°å€¤è¨ˆç®—ã—ã‚„ã™ã„ï¼‰åŒå€¤ãªå•é¡Œ

ã“ã®æœ€å°åŒ–å•é¡Œã¯ä»¥ä¸‹ã¨åŒå€¤ã§ã™ï¼

$$
\min_{\boldsymbol{w} \geq 0} \left| \boldsymbol{A} \boldsymbol{w} - \sqrt{4\pi}\boldsymbol{e}_0 \right| 
$$

ã“ã“ã§ï¼Œ

$$
\begin{align*}
\boldsymbol{A} &\equiv \begin{pmatrix} \boldsymbol{A}_1^T \\ \boldsymbol{A}_2^T \end{pmatrix} \in \mathbb{R}^{(N+1)^2\times M} \\
\boldsymbol{A}_1 &\equiv \mathrm{Re} (Y_k^n(\boldsymbol{x}_i))_{i=0,\dots, M-1, n=0,\dots,N, 0\leq k\leq n} \in \mathbb{R}^{M \times \frac{(N+1)(N+2)}{2}} \\
\boldsymbol{A}_1 &\equiv \mathrm{Im} (Y_k^n(\boldsymbol{x}_i))_{i=0,\dots, M-1, n=1,\dots,N, -n\leq k\leq -1} \in \mathbb{R}^{M \times \frac{N(N+1)}{2}}
\end{align*}
$$

ä»¥ä¸‹ã®æ•°å€¤è¨ˆç®—ã§ã¯ï¼Œã“ã®æœ€å°åŒ–å•é¡Œã‚’è§£ã„ã¦ã„ãã“ã¨ã«ãªã‚Šã¾ã™ï¼

## æ•°å€¤è¨ˆç®—æ–¹æ³•

ä¸Šè¨˜ã®æœ€å°åŒ–å•é¡Œã‚’è¨ˆç®—ã™ã‚‹ã¨ãã«ï¼Œä»¥ä¸‹ã®2ã¤ã®å›°é›£ãŒã‚ã‚Šã¾ã™ï¼

1. å·¨å¤§ãªè¡Œåˆ—ã¨ãƒ™ã‚¯ãƒˆãƒ«ã®ç©ï¼Œ$\boldsymbol{A} \boldsymbol{w}$ã‚’è¨ˆç®—ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼
2. æœ€å°åŒ–å•é¡Œã‚’è§£ã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼

1.ã«é–¢ã—ã¦ã¯ï¼Œé›¢æ•£ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ï¼ˆDFTï¼‰ã®å•é¡Œã¨åŒã˜ã§ã™ãŒï¼Œé€šå¸¸ã®DFTã§ã¯ï¼Œä»£è¡¨ç‚¹$\{\boldsymbol{x}_0, \dots, \boldsymbol{x}_{M-1}\}$ã¯ç­‰é–“éš”ã«ä¸¦ã‚“ã§ã„ã¾ã™ãŒï¼Œä»Šå›ã®å•é¡Œã§ã¯ï¼Œç­‰é–“éš”ã¨ã¯é™ã‚Šã¾ã›ã‚“ï¼
ã“ã®ã‚ˆã†ãªï¼Œä¸ç­‰é–“éš”ã®ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã‚’å®Ÿè¡Œã™ã‚‹ã®ã¯ã‚³ã‚¹ãƒˆã®å¤§ããªå•é¡Œã§ã—ãŸãŒï¼Œæœ€è¿‘ã§ã¯ï¼Œ$\mathcal{O}(N^2\log^2 N  + M)$ã§è§£ã‘ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒã‚ã£ã¦ï¼Œ[Cè¨€èªãƒ©ã‚¤ãƒ–ãƒ©ãƒ«](https://www-user.tu-chemnitz.de/~potts/nfft/index.php)ã‚‚ä½œã‚‰ã‚Œã¦ã„ã¾ã™ï¼

2.ã«é–¢ã—ã¦ã¯ï¼Œæ§˜ã€…ãªæ–¹æ³•ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ãŒï¼Œä»Šå›ã¯å…±å½¹å‹¾é…æ³•ã®ä¸€ç¨®ã§ã‚ã‚‹CGNRæ³•ã‚’ç”¨ã„ã¾ã™ï¼ã“ã“ã§å•é¡Œã«ãªã‚‹ã®ã¯ï¼Œé‡ã¿$\boldsymbol{w}$ã¯æ­£å®šå€¤ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã¨ã„ã†ã“ã¨ã§ã™ï¼æ™®é€šã«CGNRæ³•ã«ã‚ˆã£ã¦æœ€å°åŒ–å•é¡Œã‚’è§£ã„ã¦ã‚‚ï¼Œæ­£å®šå€¤æ€§ã¯æ‹…ä¿ã—ã¦ãã‚Œã¾ã›ã‚“ï¼

ãã“ã§ï¼Œæ¢ç´¢ç¯„å›²ã‚’ $\boldsymbol{w} > 0$ ã«é™ã£ãŸCGNRæ³•ã‚’è¡Œãªã£ã¦ï¼Œæ­£å®šå€¤æ€§ã‚’æ‹…ä¿ã—ã¾ã™ï¼

### NFFTã«ã‚ˆã‚‹è¨ˆç®—

ã¾ãšï¼ŒNFFTã«ã‚ˆã£ã¦ï¼Œ $\boldsymbol{Aw}$ ã‚’è¨ˆç®—ã—ã¾ã™ï¼ä»Šå›ã¯ï¼Œ[NFFTãƒ©ã‚¤ãƒ–ãƒ©ãƒª](https://www-user.tu-chemnitz.de/~potts/nfft/index.php)ã‚’ä½¿ã„ã¾ã™ï¼NFFTãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç‰¹ã«ï¼Œçƒé¢ä¸Šãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã®æ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼Œ[åˆ¥è¨˜äº‹](https://zenn.dev/ksttr/articles/nfft-tutorial-nfsft)ã‚’å‚ç…§ã—ã¦ä¸‹ã•ã„ï¼



### CGNRæ³•ã«ã‚ˆã‚‹æœ€å°åŒ–å•é¡Œã®è§£æ³•

## ä¾‹

# å‚è€ƒæ–‡çŒ®

1. Manuel Gr$\ddot{\mathrm{a}}$f, Stefan Kunis, and, Daniel Potts. On the computation of nonegative quadrature weights on the sphere. Appl. Comput. Harm. Anal. 27(1), 2009, doi:10.1016/j.acha.2008.12.003
2. Kerstin Hesse, Ian H. Sloan, and Robert S. Womersley. Numerical Integration on the Sphere. In W. Freeden et al. (eds.), Handbook of Geomathematics, Springer: Berlin 2015, doi:10.1007/978-3-642-54551-1_4