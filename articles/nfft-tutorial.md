---
title: "NFFTãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä½¿ã„æ–¹"
emoji: "ğŸ•Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["c","cpp", "fft", "nfft"]
published: false
---


# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã§ã¯ï¼Œ[Cè¨€èªãƒ©ã‚¤ãƒ–ãƒ©ãƒªNFFT](https://www-user.tu-chemnitz.de/~potts/nfft/index.php)ã®ä½¿ç”¨æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ï¼

# NFFTã¨ã¯

ã¾ãšã¯ï¼Œã¨ã¦ã‚‚ç°¡å˜ã«NFFTã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ï¼ 

é›¢æ•£ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›

$$
f_j = f(\boldsymbol{x}_j) = \sum_{\boldsymbol{k}} \hat{f}_{\boldsymbol{k}} e^{-2\pi i \boldsymbol{k}\cdot\boldsymbol{x}_j}
$$

ã®ãƒãƒ¼ãƒ‰$\boldsymbol{x}_j$ãŒä¸ç­‰é–“éš”ã§ã‚ã‚‹å ´åˆã‚’ï¼Œä¸ç­‰é–“éš”é›¢æ•£ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ï¼ˆNDFTï¼‰ã¨è¨€ã„ã¾ã™ï¼

ãƒ•ãƒ¼ãƒªã‚¨ä¿‚æ•°$\hat{f}_{\boldsymbol{k}}$ãŒä¸ãˆã‚ŒãŸæ™‚ã«ï¼Œå…ƒã®é–¢æ•°$f_j$ã‚’é«˜é€Ÿã«æ±‚ã‚ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä¸ç­‰é–“éš”é«˜é€Ÿãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ï¼ˆNFFTï¼‰ã¨è¨€ã„ã¾ã™ï¼

è¡Œåˆ—ã§æ›¸ãã¨ï¼Œ

$$
\boldsymbol{f} = \boldsymbol{A} \boldsymbol{\hat{f}},
$$

$$
\boldsymbol{f} = (f_j)_{j=0,\dots, M-1}, \quad \boldsymbol{\hat{f}} = (f_{\boldsymbol{k}})_{\boldsymbol{k}}, \quad \boldsymbol{A} = \left(e^{-2\pi i \boldsymbol{k}\cdot\boldsymbol{x}_j } \right)_{j=0,\dots, M-1; \boldsymbol{k}}, 
$$

ã¨ãªã‚Šï¼ŒNFFTã¨ã¯ï¼Œå·¨å¤§ãªç–è¡Œåˆ—$\boldsymbol{A}$ã¨ãƒ™ã‚¯ãƒˆãƒ«$\boldsymbol{\hat{f}}$ã®ç©ã‚’åŠ¹ç‡ã‚ˆãæ±‚ã‚ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼Œã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ï¼


é€šå¸¸ã®FFTã¯ï¼Œãƒãƒ¼ãƒ‰$\boldsymbol{x}_0, \dots, \boldsymbol{x}_{M-1}$ãŒç­‰é–“éš”ã«ä¸¦ã‚“ã§ã„ã‚‹å ´åˆã«ã®ã¿é©ç”¨ã§ãã¾ã™ãŒï¼Œä»Šå›ã®NFFTã§ã¯ï¼Œä¸ç­‰é–“éš”ã«ä¸¦ã‚“ã§ã„ã‚‹å ´åˆã§ã‚‚å®Ÿè¡Œã§ãã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã™ï¼

# è¨ˆç®—é‡

1æ¬¡å…ƒNFFTã®è¨ˆç®—é‡ã¯ï¼Œ

$$
\mathcal{O}\left(N\log N + \log \left(1/\varepsilon\right) M \right)
$$

ã§ã™ï¼ã€€ã“ã“ã§ï¼Œã€€$N$ã¯ãƒ•ãƒ¼ãƒªã‚¨æ³¢æ•°$\boldsymbol{k}$ã®å€‹æ•°ï¼Œ$M$ã¯ãƒãƒ¼ãƒ‰$\boldsymbol{x}_j$ã®å€‹æ•°ï¼Œ$\varepsilon$ã¯ç²¾åº¦ã‚’è¡¨ã—ã¾ã™ï¼

$d$æ¬¡å…ƒã®å ´åˆã¯ï¼Œã“ã‚Œã®$d$ä¹—ã§ã™ï¼

# NFFTãƒ©ã‚¤ãƒ–ãƒ©ãƒª

NFFTã®Cè¨€èªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä½¿ã„æ–¹ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ï¼

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
[ã“ã“](https://www-user.tu-chemnitz.de/~potts/nfft/installation.php)ã®æ‰‹é †é€šã‚Šã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ï¼

**(æ³¨æ„) äº‹å‰ã«FFTWã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ï¼**

1. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ï¼Œè§£å‡å¾Œï¼Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã‚‹ï¼

```shell 
wget https://www-user.tu-chemnitz.de/~potts/nfft/download/nfft-3.5.2.tar.gz
tar -zxf nfft-3.5.2.tar.gz
cd nfft-3.5.2
```

2. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ï¼ã€€

```shell
./configure --enable-all --enable-openmp && make
```

3. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```shell
sudo make install
```

## ä½¿ã„æ–¹

ç°¡å˜ãªä¾‹ã‚’ç¤ºã—ã¾ã™ï¼
ä»Šå›ã¯ï¼Œ ã‚³ã‚µã‚¤ãƒ³

$$
f(x) = \cos(2\pi x),  \quad x \in \left[-\frac{\pi}{2}, \frac{\pi}{2}\right]
$$

ã‚’ï¼Œãã®ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°

$$
\begin{align}
\hat{f}(k) = 
\begin{cases}
 1/2 & \mathrm{for} \quad k = \pm 1 \\
 0 & \mathrm{otherwise}
\end{cases}
\end{align}
$$

ã‹ã‚‰æ±‚ã‚ã‚‹ï¼Œã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ï¼

ãƒãƒ¼ãƒ‰$x$ã¯ãƒ©ãƒ³ãƒ€ãƒ ã«ç”¨æ„ã—ã¾ã™ï¼

```c
#include <complex.h>
#include <nfft3.h>

int main(void)
{
    nfft_plan my_plan;
    int N = 4;ã€€// æ³¢æ•°ã®å€‹æ•°
    int M = 32;ã€€// ãƒãƒ¼ãƒ‰xã®å€‹æ•°

    // planã®åˆæœŸåŒ–
    nfft_init_1d(&my_plan, N, M);

    // ãƒ©ãƒ³ãƒ€ãƒ ã«xã®å€¤ã‚’æ±ºã‚ã¦ãã‚Œã‚‹é–¢æ•°
    nfft_vrand_shifted_unit_double(my_plan.x, my_plan.M_total);

ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€// çª“é–¢æ•°ã®è¨ˆç®—
    if (my_plan.flags & PRE_ONE_PSI)
        nfft_precompute_one_psi(&my_plan);
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€// ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°
    // ä»Šå›ã¯cos(2*pi*x)ã®ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã‚’è¡Œã†
    for (int i = 0; i < my_plan.N_total; i++)
    {
        my_plan.f_hat[i] = 0;
    }
    my_plan.f_hat[my_plan.N_total / 2 - 1] = 0.5;ã€€ // æ³¢æ•°ã®å…¥ã‚Œæ–¹ã«æ³¨æ„
    my_plan.f_hat[my_plan.N_total / 2 + 1] = 0.5; // æ³¢æ•°ã®å…¥ã‚Œæ–¹ã«æ³¨æ„

ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€// NFFTã®å®Ÿè¡Œ
    nfft_trafo(&my_plan);

ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€// planã®çµ‚äº†
    nfft_finalize(&my_plan);

    return 0;
}
```

1ã¤ãšã¤èª¬æ˜ã—ã¾ã™ï¼

### å®£è¨€

ã¾ãšã¯ï¼Œå¿…è¦ãªå¤‰æ•°ã‚’å®£è¨€ã—ã¾ã™ï¼

```c
    nfft_plan my_plan;
    int N = 4;ã€€// æ³¢æ•°ã®å€‹æ•°
    int M = 32;ã€€// ãƒãƒ¼ãƒ‰xã®å€‹æ•°
```

- `nfft_plan`ã¯ï¼ŒFFTWã®ã¨ãã¨åŒã˜ã‚ˆã†ãªplanã®å®£è¨€ã§ã™ï¼ ã“ã®planå¤‰æ•°ã«ï¼ŒNFFTã®å®Ÿè¡Œã«å¿…è¦ãªã‚‚ã®ã‚’ã™ã¹ã¦è©°ã‚è¾¼ã‚“ã§ã„ãã¾ã™ï¼
- `N`ã¯æ³¢æ•°ã®å€‹æ•°ã§ã™ï¼ã€€`N=4`ãªã®ã§ï¼Œ$k=-2, -1, 0, 1$ã¨ãªã‚Šã¾ã™ï¼
- `M`ã¯ãƒãƒ¼ãƒ‰$x$ã®å€‹æ•°ã§ã™ï¼ã€€ãƒãƒ¼ãƒ‰$x$ã¯ä»¥ä¸‹ã§è¨­å®šã—ã¾ã™ï¼

### åˆæœŸåŒ–

ãƒ—ãƒ©ãƒ³ã‚’åˆæœŸåŒ–ã—ã¾ã™ï¼

```c
    // planã®åˆæœŸåŒ–
    nfft_init_1d(&my_plan, N, M);
```

ãƒ—ãƒ©ãƒ³ã®åˆæœŸåŒ–ã‚’ã—ã¦ã„ã¾ã™ï¼

æ§‹é€ ä½“nfft_planå‹ã®my_planã®ãƒ¡ãƒ³ãƒã«ã¯ï¼Œ


| my_plan.N_total | ãƒãƒ¼ãƒ‰$x$ã®å€‹æ•°       |
|     ----        | ---- |
| my_plan.M_total | ãƒ•ãƒ¼ãƒªã‚¨æ³¢æ•°$k$ã®å€‹æ•°  |
| my_plan.x       | ãƒãƒ¼ãƒ‰$x$ã‚’è¡¨ã™ãƒã‚¤ãƒ³ã‚¿ |
| my_plan.f_hat   | ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°$\hat{f}$ã‚’è¡¨ã™ãƒã‚¤ãƒ³ã‚¿ |
| my_plan.f       | æ±‚ã‚ãŸã„é–¢æ•°$f$ã‚’è¡¨ã™ãƒã‚¤ãƒ³ã‚¿|


ãªã©ãŒã„ã¾ã™ï¼


## ãƒãƒ¼ãƒ‰ã‚’æ±ºã‚ã‚‹

ãƒãƒ¼ãƒ‰$x$ã‚’æ±ºã‚ã¾ã™ï¼
ã“ã‚Œã¯ï¼Œ$[-1/2, 1/2]$ã®ç¯„å›²ã§ã‚ã‚Œã°ãªã‚“ã§ã‚‚è‰¯ã„ã§ã™ï¼ˆ**ç­‰é–“éš”ã§ã‚ã‚‹å¿…è¦ã‚‚ãªã„ã—ï¼Œå°ã•ã„æ–¹ã‹ã‚‰é †ç•ªã«æ ¼ç´ã™ã‚‹å¿…è¦ã‚‚ãªã„ï¼ï¼**ï¼‰ï¼

```c
    // ãƒ©ãƒ³ãƒ€ãƒ ã«xã®å€¤ã‚’æ±ºã‚ã¦ãã‚Œã‚‹é–¢æ•°
    nfft_vrand_shifted_unit_double(my_plan.x, my_plan.M_total);
```

ä»Šå›ã¯ï¼ŒNFFTãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæä¾›ã™ã‚‹ï¼Œãƒ©ãƒ³ãƒ€ãƒ ã«æ ¼ç´ã—ã¦ãã‚Œã‚‹é–¢æ•°`nfft_vrand_shifted_unit_double`ã‚’ä½¿ã„ã¾ã™ï¼

### çª“é–¢æ•°ã®è¨ˆç®—

ä»Šå›ç†è«–ã®èª¬æ˜ã§ç«¯æŠ˜ã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒï¼ŒNFFTã¯ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã‚’çª“é–¢æ•°ã®å’Œã§è¿‘ä¼¼ã—ã¾ã™ï¼
ãã®ãŸã‚ï¼Œçª“é–¢æ•°ã‚’æ±ºã‚ï¼Œã‚ã‚‰ã‹ã˜ã‚è¨ˆç®—ã™ã‚‹ã¨ã„ã†ã‚¹ãƒ†ãƒƒãƒ—ãŒå…¥ã‚Šã¾ã™ï¼

```c
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€// çª“é–¢æ•°ã®è¨ˆç®—
    if (my_plan.flags & PRE_ONE_PSI)
        nfft_precompute_one_psi(&my_plan);
```

ä»Šå›ã¯ï¼Œ`nfft_precompute_one_psi`ã¨ã„ã†é–¢æ•°ã‚’ä½¿ã£ã¦ï¼Œè¨ˆç®—ã—ã¾ã™ï¼
çª“é–¢æ•°ã®è©³ç´°ãªèª¬æ˜ã‚„è¨­å®šã¯ï¼Œè¨˜äº‹ã‚’åˆ†ã‘ã‚ˆã†ã¨æ€ã„ã¾ã™ï¼

### ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°ã®è¨ˆç®—

ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°ã®è¨ˆç®—ã‚’ã—ã¾ã™ï¼

```c
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€// ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°
    // ä»Šå›ã¯cos(2*pi*x)ã®ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã‚’è¡Œã†
    for (int i = 0; i < my_plan.N_total; i++)
    {
        my_plan.f_hat[i] = 0;
    }
    my_plan.f_hat[my_plan.N_total / 2 - 1] = 0.5;ã€€ // æ³¢æ•°ã®å…¥ã‚Œæ–¹ã«æ³¨æ„
    my_plan.f_hat[my_plan.N_total / 2 + 1] = 0.5; // æ³¢æ•°ã®å…¥ã‚Œæ–¹ã«æ³¨æ„
```

ä»Šå›ã¯ã‚³ã‚µã‚¤ãƒ³ãªã®ã§ç°¡å˜ã§ã™ï¼

### NFFTã®å®Ÿè¡Œ

NFFTã‚’å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ï¼

```c
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€// NFFTã®å®Ÿè¡Œ
    nfft_trafo(&my_plan);
```

- `nfft_trafo`ã§NFFTã‚’å®Ÿè¡Œã—ã¾ã™ï¼
- `my_plan.f`ã«å®Ÿè¡ŒçµæœãŒæ ¼ç´ã•ã‚Œã¾ã™ï¼

ã¾ãŸï¼Œç¬¦å·ãŒé€†ã®å¤‰æ›ï¼Œ

$$
\hat{f}_k = \sum_{j=0}^{M-1} f_j e^{+2\pi i kx_j}
$$

ã‚’æ±‚ã‚ã‚‹ã¨ãã¯ï¼Œ `nfft_adjoint`ã‚’ä½¿ã„ã¾ã™ï¼

### çµ‚äº†å‡¦ç†

æœ€å¾Œã«ãƒ—ãƒ©ãƒ³ã‚’ç ´æ£„ã—ã¦çµ‚äº†ã§ã™ï¼

```c
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€// planã®çµ‚äº†
    nfft_finalize(&my_plan);
```



# ãŠã‚ã‚Šã«

ä»Šå›ã¯ï¼ŒNFFTã‚’å®Ÿè¡Œã™ã‚‹Cè¨€èªãƒ©ã‚¤ãƒ–ãƒ©ãƒªNFFTã®èª¬æ˜ã‚’ã—ã¾ã—ãŸï¼
ç°¡å˜ãªä½¿ç”¨ä¾‹ã«ã¨ã©ã‚ã¾ã—ãŸãŒï¼Œã“ã‚Œä»¥å¤–ã«ã‚‚ï¼Œ

- é€†ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›
- 2æ¬¡å…ƒä»¥ä¸Šã®é«˜æ¬¡å…ƒãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›
- é«˜é€Ÿã‚µã‚¤ãƒ³ãƒ»ã‚³ã‚µã‚¤ãƒ³å¤‰æ›ï¼ˆNFCT,NFST)
- çƒé¢ä¸Šã®å¤‰æ›ï¼ˆçƒé¢èª¿å’Œé–¢æ•°å±•é–‹ï¼‰NSFST

ãªã©ï¼Œæ§˜ã€…ãªæ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ï¼ã“ã‚Œã‚‰ã«ã¤ã„ã¦ã‚‚ä»Šå¾Œè¨˜äº‹ã«ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ï¼

